- group: Exploitation for Privilege Escalation
  description: |
    Adversaries may exploit software vulnerabilities in an attempt to elevate privileges.
    Exploitation of a software vulnerability occurs when an adversary takes advantage of
    a programming error in a program, service, or within the operating system software or
    kernel itself to execute adversary-controlled code. Security constructs such as permission
    levels will often hinder access to information and use of certain techniques, so adversaries
    will likely need to perform privilege escalation to include use of software exploitation to
    circumvent those restrictions.

    Adversaries may bring a signed vulnerable driver onto a compromised machine so that they can
    exploit the vulnerability to execute code in kernel mode. This process is sometimes referred
    to as Bring Your Own Vulnerable Driver (BYOVD). Adversaries may include the vulnerable driver
    with files delivered during Initial Access or download it to a compromised system via Ingress
    Tool Transfer or Lateral Tool Transfer.
  labels:
    tactic.id: TA0004
    tactic.name: Privilege Escalation
    tactic.ref: https://attack.mitre.org/tactics/TA0004/
    technique.id: T1068
    technique.name: Exploitation for Privilege Escalation
    technique.ref: https://attack.mitre.org/techniques/T1068/
  rules:
    - name: Vulnerable or malicious driver dropped
      description: |
        Detects when adversaries drop a vulnerable/malicious driver
        onto a compromised system as a preparation for vulnerability
        exploitation that leads to code execution in kernel mode.
      condition: >
        create_file
            and
        (file.is_driver_vulnerable or file.is_driver_malicious)
      output: >
        %file.name is a known vulnerable/malicious driver created
        by process %ps.name and parent process %ps.parent.name
      min-engine-version: 2.0.0
    - name: Vulnerable or malicious driver loaded
      description: |
        Detects when adversaries load a vulnerable/malicious driver
        into the compromised system to exploit the vulnerability and
        execute code in kernel mode to bypass security controls.
      condition: >
        (load_driver)
            and
        (image.is_driver_vulnerable or image.is_driver_malicious)
      output: >
        %file.name is a known vulnerable/malicious driver with the
        certificate issued by %image.cert.issuer and valid until
        %image.cert.after
      min-engine-version: 2.0.0
